name: Debug OpenShift Deployment

on:
  workflow_dispatch:

env:
  OPENSHIFT_SERVER: ${{ secrets.OPENSHIFT_SERVER }}
  NAMESPACE: ${{ secrets.NAMESPACE || 'storebox' }}
  APP_NAME: storebox

jobs:
  debug:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
      
    - name: Install OpenShift CLI
      uses: redhat-actions/openshift-tools-installer@v1
      with:
        oc: '4.12.0'
        skip_cache: true
      
    - name: Test OpenShift Connection
      run: |
        echo "Testing OpenShift connection..."
        oc login --token=${{ secrets.OPENSHIFT_TOKEN }} --server=${{ env.OPENSHIFT_SERVER }} --insecure-skip-tls-verify=true
        echo "Logged in as:"
        oc whoami
        echo "Available projects:"
        oc projects
        echo "Creating/selecting namespace..."
        oc project ${{ env.NAMESPACE }} || oc new-project ${{ env.NAMESPACE }}
        echo "Current project:"
        oc project
